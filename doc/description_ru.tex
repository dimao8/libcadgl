\documentclass[a4paper, 12pt]{article}
\usepackage[russian]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage{indentfirst}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{amsmath}

\addto\captionsrussian{\renewcommand{\figurename}{Рисунок}}

\title{Библиотека libcadgl \\ \small{Техническое описание} \\ \small{\textit{Ревизия 1.0}}}
\date{2022}

\begin{document}
\maketitle

\newpage
\tableofcontents

\newpage
\section{Назначение библиотеки}
\label{section:library}
Библиотека libcadgl предназначена для создания CAD-подобных систем.

Ядро библиотеки -- работа с геометрическими элементами и их иерархическими
взаимосвязями. При этом работа ведется в евклидовом пространстве.

\paragraph{Единицы измерения}
Библиотека оперирует единицами измерения СИ, при этом используя отмасштабированные
значения. Ниже представлена таблица единиц измерения для основного представления.

\begin{table}[!h]
  \caption{Список единиц измерения libcadgl}
  \label{table:si_units}
  \begin{tabular}{|p{3cm}|p{3cm}|p{7cm}|}
    \hline
    \multicolumn{1}{|c|}{\textbf{Имя}} & \multicolumn{1}{|c|}{\textbf{Мера СИ}} & \multicolumn{1}{|c|}{\textbf{Примечание}} \\ \hline
    Длина & м, Метр & Используется внутреннее представление в миллиметрах,
    которые обрезаются до целого числа. Сделано для точных привязок. \\ \hline
    Время & с, Секунда & Зарезервировано для вычисления подвижных элементов. \\ \hline
    Масса & кг, Килограмм & Зарезервировано для расчетов МЦХ и импульсов. \\ \hline
    Угол & Радиан & В интерфейсе преобразуется в градус. \\ \hline
    Сила тока & А, Ампер & Зарезервировано для электрических CAD систем. \\ \hline
    Разность потенциалов & В, Вольт & Зарезервировано для электрических CAD систем. \\ \hline
    Электрическое сопротивление & Ом & Зарезервировано для электрических CAD систем. \\ \hline
    Индуктивность & Гн, Генри & Используется дробное представление в наногенри. Зарезервировано для электрических CAD систем. \\ \hline
    Емкость & Ф, Фарад & Используется дробное представление в пикофарадах.
    Зарезервировано для электрических CAD систем. \\ \hline
  \end{tabular}
\end{table}

В самом ядре все расчеты ведутся в СИ в числах с плавающей запятой. Когда необходимо
определить точку привязки или напечатать значение, используется представление,
указанное в примечании.

Библиотека имеет несколько модулей.

\begin{description}
  \item[Модуль CAD.] Этот модуль обсчитывает простую геометрию. Все элементы геометрии
  полностью изолированы от графического представления. К примеру, основная линия -- это
  просто тип линии; как она будет выглядеть на экране или бумаге -- не является задачей
  модуля.

  Внутри модуля есть вычислитель большинства геометрических задач. На выходе из модуля
  есть только набор геометрических фигур со своими координатами, и их тип.

  \item[Модуль рендера.] На самом деле модулей два. Один отображает данные на экране,
  второй -- на листе для печати. Этот модуль оперирует только с простыми
  геометрическими объектами типа линий, дуг, залитых многоугольников, текста и пр.

  Этот модуль также отвечает за внешний вид отображения. Все темы и украшения ложатся
  на плечи этого модуля.

  \item[Модуль калькулятора.] Вспомогательный модуль, позволяющий вычислять простые
  математические выражения прямо при установке числовых значений. Например, при вводе
  пользователем в поле длины отрезка выражения $(128.2-13.4)/2$ результатом будет
  число $57.4$. Кроме того модуль сам определяет попытку ввода разделительной точки
  или запятой.
\end{description}

\section{Моудуль калькулятора}
Модуль калькулятора состоит из модуля лексического анализа и модуля синтаксического
анализа с функцией сокращения выражения. Рассмотрим грамматику математических выражений
для калькулятора.

\begin{verbatim}
expression ::= <term1> + <expression> | <term1> - <expression> | <term1>
term1 ::= <term2> * <term1> | <term2> / <term1> | <term2>
term2 ::= <term3> ^ <term2> | <term3>
term3 ::= -<term4> | <term4>
term4 ::= <function><term5> | <term5>
term5 ::= <number> | (<expression>)
\end{verbatim}

Разбор чисел берет на себя модуль лексического анализатора. После его работы
появляется список всех лексем в порядке следования в выражении. Всего есть
три основных лексемы: number, operator, function. Также имеется лексема-заглушка
eof.

Синтаксический разбор выполняется рекурсивно, возвращая все внутренние выражения
в виде числового результата. В процессе подъема по дереву сокращается количество
операций, пока они все не сведутся к единстенному числу.

\section{Размеры страницы}
Как указано в разделе \ref{section:library} размеры измеряются в миллиметрах,
поскольку большинство чертежей не превышают размеров 1~м. Размеры в миллиметрах
преобразуются в размеры в пикселях при помощи проекционной матрицы
ортографической проекции:
\begin{equation}
  \begin{pmatrix}
    \frac{2}{right - left} & 0 & 0 & t_x \\
    0 & \frac{2}{top - bottom} & 0 & t_y \\
    0 & 0 & \frac{-2}{far - near} & t_z \\
    0 & 0 & 0 & 1
  \end{pmatrix},
\end{equation}

\begin{tabbing}
где \= $t_x = -\frac{right + left}{right - left}$ \\
\> $t_y = -\frac{top + bottom}{top - bottom}$ \\
\> $t_z = -\frac{far + near}{far - near}$.
\end{tabbing}

Чтобы правильно заполнить матрицу, необходимо определить положение нулевой точки,
совпадающей с левым нижним углом, а также определить размер по вертикали или
горизонтали. Для расчетов также потребуется т.~н. аспект или соотношение сторон
для листа и области отображения. Соотношение сторон определяется как
$aspect = \frac{width}{height}$.

Для формирования матрицы проекции необходимо знать, какре соотношение сторон
больше. К примеру, размер области отображения $800\times 600$, в то время как
размер листа А4 $210\times 297$. Соответственно, соотношения сторон получаются
$1,3[3]$ и $0,7[07]$. Поскольку соотношение сторон для области отображения больше
чем для листа, лист будет вписан в область отображения по вертикали, а
горизонтальный размер будет при этом меньше горизонтального размера области
отображения.

Теперь, когда выбрано направление привязки листа, можно вычислить размер области
отображения. Учитывая, что размер области в OpenGL по умолчанию всегда $(-1;1)$,
то алгоритм определения расстояний до границ области следующий:
\begin{itemize}
  \item[--] Сравнение соотношения сторон для листа и области отображения;
  \item[--] Если соотношение сторон больше у листа, нежели у области отображения,
    то выбор фиксации размера производится по горизонтальному размеру. В
    противном случае выбирается вертикальный размер;
  \item[--] После выбора фиксирующего размера определяются границы:
    $left = \frac{-width}{2}$, $right = \frac{width}{2}$ или
    $top = \frac{height}{2}$, $bottom = \frac{-height}{2}$. Здесь \textit{width},
    \textit{height} -- отношение размеров листа в миллиметрах к соответствующему
    размеру области отображения в пикселях;
    
\end{itemize}

\end{document}
